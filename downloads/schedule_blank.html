<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸€æ—¥ã®è¨ˆç”» ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&family=Kaisei+Decol:wght@700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #faf7f2;
    --ink: #1c1710;
    --gold: #b8892a;
    --line: #e0d5c0;
    --card: #ffffff;
    --write-line: #c8d8e8;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #bbb;
    font-family: 'Noto Sans JP', sans-serif;
    padding: 16px;
  }

  /* â”€â”€ TOP BAR â”€â”€ */
  .topbar {
    width: 210mm;
    margin: 0 auto 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }
  .topbar-date {
    font-size: 11pt;
    color: #555;
    margin-right: auto;
  }
  .btn {
    background: #3a3028;
    color: #fdf8ee;
    border: none;
    border-radius: 8px;
    padding: 7px 14px;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 11pt;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
    transition: background 0.15s;
  }
  .btn:hover { background: #1c1710; }
  .btn-gold { background: var(--gold); }
  .btn-gold:hover { background: #9a7220; }
  .btn-green { background: #4a7c59; }
  .btn-green:hover { background: #3a6248; }
  .btn-sky { background: #3278a8; }
  .btn-sky:hover { background: #255f88; }

  .save-status {
    width: 210mm;
    margin: 0 auto 4px;
    font-size: 9.5pt;
    color: #666;
    text-align: right;
    min-height: 16px;
  }

  /* â”€â”€ A4 PAGE â”€â”€ */
  .page {
    width: 210mm;
    height: 297mm;
    background: var(--bg);
    margin: 0 auto;
    padding: 7mm 13mm 7mm;
    overflow: hidden;
  }

  /* HEADER */
  .header {
    text-align: center;
    margin-bottom: 4mm;
    border-bottom: 2.5px solid var(--gold);
    padding-bottom: 3mm;
  }
  .header-sub { font-size: 8pt; letter-spacing: 0.22em; color: #8a7a62; margin-bottom: 1mm; }
  .header-title { font-family: 'Kaisei Decol', serif; font-size: 22pt; font-weight: 700; color: var(--ink); letter-spacing: 0.12em; }

  /* GOAL BANNER */
  .goal-banner {
    background: #fff8e8;
    border-radius: 10px;
    padding: 3mm 4mm;
    margin-bottom: 3.5mm;
    display: flex;
    align-items: flex-start;
    gap: 3mm;
    border: 2px solid var(--gold);
  }
  .goal-icon { font-size: 17pt; flex-shrink: 0; margin-top: 1mm; }
  .goal-body { flex: 1; min-width: 0; }
  .goal-label { font-size: 7pt; letter-spacing: 0.18em; color: var(--gold); margin-bottom: 1.5mm; }
  .write-line-light {
    width: 100%; background: transparent; border: none;
    border-bottom: 1.5px solid #d4a840; color: var(--ink);
    font-family: 'Noto Sans JP', sans-serif; font-size: 12pt; font-weight: 700;
    padding: 0.5mm 0; outline: none; margin-bottom: 2mm;
  }
  .write-line-light::placeholder { color: #d4c090; font-weight: 400; }
  .memo-row { display: flex; align-items: center; gap: 2mm; margin-bottom: 1.5mm; }
  .memo-row:last-child { margin-bottom: 0; }
  .memo-icon { font-size: 11pt; flex-shrink: 0; }
  .memo-input {
    flex: 1; background: transparent; border: none;
    border-bottom: 1px solid #d4b870; color: var(--ink);
    font-family: 'Noto Sans JP', sans-serif; font-size: 11pt;
    padding: 0.5mm 0; outline: none;
  }
  .memo-input::placeholder { color: #c8b880; }

  /* CHECKBOX */
  label.cb-row { display: flex; align-items: flex-start; gap: 2mm; margin-bottom: 1.5mm; cursor: pointer; }
  label.cb-row:last-child { margin-bottom: 0; }
  .cb-row input[type="checkbox"] {
    appearance: none; -webkit-appearance: none;
    width: 15px; height: 15px;
    border: 2px solid var(--accent-color, #999); border-radius: 3px;
    flex-shrink: 0; margin-top: 2px; cursor: pointer; position: relative; background: transparent;
  }
  .cb-row input[type="checkbox"]:checked { background: var(--accent-color, #999); }
  .cb-row input[type="checkbox"]:checked::after {
    content: ''; position: absolute; left: 2px; top: 0px;
    width: 6px; height: 10px;
    border: 2px solid #fff; border-top: none; border-left: none; transform: rotate(42deg);
  }
  .cb-write {
    flex: 1; background: transparent; border: none;
    border-bottom: 1px solid var(--write-line);
    font-family: 'Noto Sans JP', sans-serif; font-size: 10pt; color: var(--ink);
    padding: 0.5mm 0; outline: none; min-width: 0;
  }
  .cb-write::placeholder { color: #c0b8a8; font-size: 9pt; }
  .cb-row input:checked + .cb-write { color: #aaa; text-decoration: line-through; }

  /* TIMELINE */
  .timeline { position: relative; padding-left: 11mm; }
  .timeline::before {
    content: ''; position: absolute; left: 3mm; top: 6mm; bottom: 6mm; width: 2px;
    background: linear-gradient(to bottom, #f0d080, var(--line) 50%, #a0d4b0);
  }

  /* BLOCK */
  .block { position: relative; margin-bottom: 2mm; }
  .block-dot {
    position: absolute; left: -8.5mm; top: 4.5mm; width: 9px; height: 9px;
    border-radius: 50%; background: var(--accent-color, #999);
    border: 2px solid var(--bg); box-shadow: 0 0 0 1.5px var(--accent-color, #999); z-index: 1;
  }
  .block-card {
    background: var(--card); border-radius: 9px; padding: 2mm 4mm 2mm 4mm;
    border: 1.5px solid var(--line); border-left: 5px solid var(--accent-color, #ccc);
  }
  .block-top { display: flex; align-items: center; gap: 2mm; margin-bottom: 1.5mm; }
  .block-emoji { font-size: 13pt; flex-shrink: 0; }
  .time-input {
    background: transparent; border: none;
    border-bottom: 1.5px solid var(--accent-color, #bbb);
    font-family: 'Noto Sans JP', sans-serif; font-size: 9pt; font-weight: 700;
    letter-spacing: 0.1em; color: var(--accent-color, #888);
    width: 26mm; padding: 0.5mm 0; outline: none; flex-shrink: 0;
  }
  .time-input::placeholder { color: rgba(150,140,120,0.4); font-weight: 400; }
  .title-input {
    flex: 1; background: transparent; border: none;
    border-bottom: 1.5px solid var(--line);
    font-family: 'Noto Sans JP', sans-serif; font-size: 12pt; font-weight: 700;
    color: var(--ink); padding: 0.5mm 0; outline: none; min-width: 0;
  }
  .title-input::placeholder { color: #c8baa0; font-weight: 400; font-size: 10pt; }
  .tasks { display: flex; flex-direction: column; }

  /* FOOTER */
  .footer { text-align: center; margin-top: 3mm; font-size: 9pt; color: #8a7a62; letter-spacing: 0.15em; }

  /* â”€â”€ MODAL â”€â”€ */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.45); z-index: 200;
    align-items: center; justify-content: center; padding: 20px;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--bg); border-radius: 14px; padding: 22px;
    width: 420px; max-width: 100%; max-height: 88vh; overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }
  .modal-title {
    font-family: 'Kaisei Decol', serif; font-size: 18pt; font-weight: 700;
    color: var(--ink); margin-bottom: 14px; padding-bottom: 10px;
    border-bottom: 2px solid var(--gold);
  }
  .save-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
  .save-item {
    display: flex; align-items: center; gap: 8px;
    background: white; border: 1.5px solid var(--line); border-radius: 8px;
    padding: 10px 12px; cursor: pointer; transition: border-color 0.15s;
  }
  .save-item:hover { border-color: var(--gold); }
  .save-item-date { font-size: 11pt; font-weight: 700; color: var(--ink); flex: 1; }
  .save-item-goal { font-size: 9.5pt; color: #8a7a62; flex: 2; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
  .save-item-del {
    background: none; border: none; color: #ccc; font-size: 14pt;
    cursor: pointer; padding: 0 4px; line-height: 1;
  }
  .save-item-del:hover { color: var(--rust, #c45528); }
  .modal-empty { font-size: 10.5pt; color: #aaa; text-align: center; padding: 20px 0; }
  .modal-close-row { text-align: right; }
  .modal-close-btn {
    background: none; border: 1.5px solid var(--line); border-radius: 7px;
    padding: 6px 14px; font-family: 'Noto Sans JP', sans-serif;
    font-size: 10.5pt; cursor: pointer; color: #8a7a62;
  }
  .modal-close-btn:hover { background: var(--line); }

  /* PRINT */
  @media print {
    body { background: white; padding: 0; }
    .topbar, .save-status { display: none !important; }
    .page { box-shadow: none; margin: 0; }
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    input { border-color: inherit !important; }
  }
</style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <span class="topbar-date" id="todayLabel"></span>
  <button class="btn btn-gold" onclick="saveToday()">ğŸ’¾ ä»Šæ—¥ã®å†…å®¹ã‚’ä¿å­˜</button>
  <button class="btn btn-green" onclick="openLoadModal()">ğŸ“‚ éå»ã®è¨ˆç”»ã‚’èª­ã¿è¾¼ã‚€</button>
  <button class="btn btn-sky" onclick="exportJSON()">â¬‡ï¸ JSONã§æ›¸ãå‡ºã—</button>
  <label class="btn" style="cursor:pointer">
    â¬†ï¸ JSONã‚’èª­ã¿è¾¼ã‚€
    <input type="file" accept=".json" style="display:none" onchange="importJSON(event)">
  </label>
  <button class="btn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·</button>
</div>
<div class="save-status" id="saveStatus"></div>

<!-- A4 Page -->
<div class="page">

  <div class="header">
    <div class="header-sub">TODAY'S SCHEDULE ï¼ ä»Šæ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
    <div class="header-title">ğŸˆâ€â¬› ä¸€æ—¥ã®è¨ˆç”» ğŸ¾</div>
  </div>

  <div class="goal-banner">
    <div class="goal-icon">ğŸˆâ€â¬›</div>
    <div class="goal-body">
      <div class="goal-label">TODAY'S GOAL ï¼ ä»Šæ—¥ã®ç›®å½“ã¦</div>
      <input class="write-line-light" id="f_goal" type="text" placeholder="ãã‚‡ã†ã®ç›®å½“ã¦ã‚’æ›¸ã“ã†â€¦">
      <div class="memo-row">
        <span class="memo-icon">ğŸ¾</span>
        <input class="memo-input" id="f_memo1" type="text" placeholder="ã‚ã™ã‚Œãªã„ã“ã¨â‘ ">
      </div>
      <div class="memo-row">
        <span class="memo-icon">ğŸ¾</span>
        <input class="memo-input" id="f_memo2" type="text" placeholder="ã‚ã™ã‚Œãªã„ã“ã¨â‘¡">
      </div>
    </div>
  </div>

  <div class="timeline">

    <div class="block" style="--accent-color:#c45528">
      <div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸˆâ€â¬›</span>
          <input class="time-input" id="f_t1" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti1" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb1a"><input class="cb-write" id="f_w1a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb1b"><input class="cb-write" id="f_w1b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#b8892a">
      <div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸ¾</span>
          <input class="time-input" id="f_t2" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti2" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb2a"><input class="cb-write" id="f_w2a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb2b"><input class="cb-write" id="f_w2b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#3278a8">
      <div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸˆâ€â¬›</span>
          <input class="time-input" id="f_t3" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti3" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb3a"><input class="cb-write" id="f_w3a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb3b"><input class="cb-write" id="f_w3b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#7055b0">
      <div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸ¾</span>
          <input class="time-input" id="f_t4" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti4" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb4a"><input class="cb-write" id="f_w4a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb4b"><input class="cb-write" id="f_w4b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#c45528">
      <div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸˆâ€â¬›</span>
          <input class="time-input" id="f_t5" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti5" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb5a"><input class="cb-write" id="f_w5a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb5b"><input class="cb-write" id="f_w5b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#e07b2a">
      <div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸ¾</span>
          <input class="time-input" id="f_t6" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti6" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb6a"><input class="cb-write" id="f_w6a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb6b"><input class="cb-write" id="f_w6b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#4a7c59">
      <div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸˆâ€â¬›</span>
          <input class="time-input" id="f_t7" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti7" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb7a"><input class="cb-write" id="f_w7a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb7b"><input class="cb-write" id="f_w7b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

  </div>

  <div class="footer">âœ¦ ä»Šæ—¥ã‚‚ä¸€æ—¥ã‚ˆããŒã‚“ã°ã£ãŸï¼ âœ¦</div>
</div>

<!-- Load Modal -->
<div class="modal-overlay" id="loadModal">
  <div class="modal">
    <div class="modal-title">ğŸ“‚ éå»ã®è¨ˆç”»ã‚’èª­ã¿è¾¼ã‚€</div>
    <div class="save-list" id="saveList"></div>
    <div class="modal-close-row">
      <button class="modal-close-btn" onclick="closeLoadModal()">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
  // â”€â”€ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰IDä¸€è¦§ â”€â”€
  const TEXT_IDS = [
    'f_goal','f_memo1','f_memo2',
    'f_t1','f_ti1','f_w1a','f_w1b',
    'f_t2','f_ti2','f_w2a','f_w2b',
    'f_t3','f_ti3','f_w3a','f_w3b',
    'f_t4','f_ti4','f_w4a','f_w4b',
    'f_t5','f_ti5','f_w5a','f_w5b',
    'f_t6','f_ti6','f_w6a','f_w6b',
    'f_t7','f_ti7','f_w7a','f_w7b',
  ];
  const CB_IDS = [
    'f_cb1a','f_cb1b','f_cb2a','f_cb2b',
    'f_cb3a','f_cb3b','f_cb4a','f_cb4b',
    'f_cb5a','f_cb5b','f_cb6a','f_cb6b',
    'f_cb7a','f_cb7b',
  ];

  function todayStr() {
    return new Date().toLocaleDateString('ja-JP', {year:'numeric',month:'2-digit',day:'2-digit'}).replace(/\//g,'-');
  }

  // ä»Šæ—¥ã®æ—¥ä»˜ãƒ©ãƒ™ãƒ«
  document.getElementById('todayLabel').textContent =
    new Date().toLocaleDateString('ja-JP', {year:'numeric',month:'long',day:'numeric',weekday:'long'});

  // â”€â”€ ãƒ‡ãƒ¼ã‚¿åé›† â”€â”€
  function collectData() {
    const data = { date: todayStr(), texts: {}, checks: {} };
    TEXT_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) data.texts[id] = el.value;
    });
    CB_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) data.checks[id] = el.checked;
    });
    return data;
  }

  // â”€â”€ ãƒ‡ãƒ¼ã‚¿åæ˜  â”€â”€
  function applyData(data) {
    if (data.texts) TEXT_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el && data.texts[id] !== undefined) el.value = data.texts[id];
    });
    if (data.checks) CB_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el && data.checks[id] !== undefined) el.checked = data.checks[id];
    });
  }

  // â”€â”€ ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ â”€â”€
  function getSaves() {
    try { return JSON.parse(localStorage.getItem('schedule_saves') || '[]'); } catch { return []; }
  }
  function setSaves(arr) {
    localStorage.setItem('schedule_saves', JSON.stringify(arr));
  }

  function saveToday() {
    const data = collectData();
    const saves = getSaves();
    const idx = saves.findIndex(s => s.date === data.date);
    if (idx >= 0) saves[idx] = data;
    else saves.unshift(data);
    // æœ€å¤§60ä»¶ä¿æŒ
    setSaves(saves.slice(0, 60));
    showStatus('âœ… ä¿å­˜ã—ã¾ã—ãŸï¼ˆ' + data.date + 'ï¼‰');
  }

  // è‡ªå‹•ä¿å­˜ï¼ˆå…¥åŠ›ã®ãŸã³ã«ï¼‰
  [...TEXT_IDS, ...CB_IDS].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener(el.type === 'checkbox' ? 'change' : 'input', saveToday);
  });

  // â”€â”€ èª­ã¿è¾¼ã¿ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€
  function openLoadModal() {
    renderSaveList();
    document.getElementById('loadModal').classList.add('open');
  }
  function closeLoadModal() {
    document.getElementById('loadModal').classList.remove('open');
  }
  document.getElementById('loadModal').addEventListener('click', function(e) {
    if (e.target === this) closeLoadModal();
  });

  function renderSaveList() {
    const saves = getSaves();
    const list = document.getElementById('saveList');
    if (saves.length === 0) {
      list.innerHTML = '<div class="modal-empty">ã¾ã ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ğŸ¾</div>';
      return;
    }
    list.innerHTML = saves.map((s, i) => `
      <div class="save-item" onclick="loadSave(${i})">
        <div class="save-item-date">ğŸ“… ${s.date}</div>
        <div class="save-item-goal">${s.texts?.f_goal || 'ï¼ˆç›®å½“ã¦ãªã—ï¼‰'}</div>
        <button class="save-item-del" onclick="deleteSave(event,${i})">âœ•</button>
      </div>
    `).join('');
  }

  function loadSave(i) {
    const saves = getSaves();
    if (saves[i]) {
      applyData(saves[i]);
      closeLoadModal();
      showStatus('ğŸ“‚ ' + saves[i].date + ' ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
    }
  }

  function deleteSave(e, i) {
    e.stopPropagation();
    if (!confirm('ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    const saves = getSaves();
    saves.splice(i, 1);
    setSaves(saves);
    renderSaveList();
  }

  // â”€â”€ JSONæ›¸ãå‡ºã—ï¼ˆGoogleãƒ‰ãƒ©ã‚¤ãƒ–å…±æœ‰ç”¨ï¼‰ â”€â”€
  function exportJSON() {
    const saves = getSaves();
    const blob = new Blob([JSON.stringify(saves, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'schedule_data_' + todayStr() + '.json';
    a.click();
    URL.revokeObjectURL(url);
    showStatus('â¬‡ï¸ JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã—ã¾ã—ãŸã€‚Googleãƒ‰ãƒ©ã‚¤ãƒ–ã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
  }

  // â”€â”€ JSONèª­ã¿è¾¼ã¿ï¼ˆåˆ¥PCã‹ã‚‰ã®å–ã‚Šè¾¼ã¿ï¼‰ â”€â”€
  function importJSON(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const imported = JSON.parse(e.target.result);
        if (!Array.isArray(imported)) throw new Error();
        const existing = getSaves();
        // æ—¥ä»˜é‡è¤‡ã¯ä¸Šæ›¸ãã€æ–°ã—ã„ã‚‚ã®ã¯è¿½åŠ 
        imported.forEach(item => {
          const idx = existing.findIndex(s => s.date === item.date);
          if (idx >= 0) existing[idx] = item;
          else existing.push(item);
        });
        existing.sort((a,b) => b.date.localeCompare(a.date));
        setSaves(existing.slice(0, 60));
        showStatus('âœ… ' + imported.length + 'ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šè¾¼ã¿ã¾ã—ãŸ');
        event.target.value = '';
      } catch {
        showStatus('âš ï¸ èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ­£ã—ã„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
      }
    };
    reader.readAsText(file);
  }

  // â”€â”€ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º â”€â”€
  function showStatus(msg) {
    const el = document.getElementById('saveStatus');
    el.textContent = msg;
    clearTimeout(el._t);
    el._t = setTimeout(() => { el.textContent = ''; }, 4000);
  }

  // â”€â”€ èµ·å‹•æ™‚ã«ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ â”€â”€
  (function() {
    const saves = getSaves();
    const today = saves.find(s => s.date === todayStr());
    if (today) {
      applyData(today);
      showStatus('ğŸ“‚ ä»Šæ—¥ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
    }
  })();
</script>
</body>
</html>
