<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸€æ—¥ã®è¨ˆç”» ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&family=Kaisei+Decol:wght@700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #faf7f2;
    --ink: #1c1710;
    --gold: #b8892a;
    --line: #e0d5c0;
    --card: #ffffff;
    --write-line: #c8d8e8;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #bbb;
    font-family: 'Noto Sans JP', sans-serif;
    padding: 16px;
  }

  /* â”€â”€ TOP BAR â”€â”€ */
  .topbar {
    width: 210mm;
    margin: 0 auto 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }
  .topbar-date {
    font-size: 11pt;
    color: #555;
    margin-right: auto;
  }
  .btn {
    background: #3a3028;
    color: #fdf8ee;
    border: none;
    border-radius: 8px;
    padding: 7px 14px;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 11pt;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
    transition: background 0.15s;
  }
  .btn:hover { background: #1c1710; }
  .btn-gold { background: var(--gold); }
  .btn-gold:hover { background: #9a7220; }
  .btn-green { background: #4a7c59; }
  .btn-green:hover { background: #3a6248; }
  .btn-sky { background: #3278a8; }
  .btn-sky:hover { background: #255f88; }

  .save-status {
    width: 210mm;
    margin: 0 auto 4px;
    font-size: 9.5pt;
    color: #666;
    text-align: right;
    min-height: 16px;
  }

  /* â”€â”€ A4 PAGE â”€â”€ */
  .page {
    width: 210mm;
    height: 297mm;
    background: var(--bg);
    margin: 0 auto;
    padding: 7mm 13mm 7mm;
    overflow: hidden;
  }

  /* HEADER */
  .header {
    text-align: center;
    margin-bottom: 4mm;
    border-bottom: 2.5px solid var(--gold);
    padding-bottom: 3mm;
  }
  .header-sub { font-size: 8pt; letter-spacing: 0.22em; color: #8a7a62; margin-bottom: 1mm; }
  .header-title { font-family: 'Kaisei Decol', serif; font-size: 22pt; font-weight: 700; color: var(--ink); letter-spacing: 0.12em; }

  /* GOAL BANNER */
  .goal-banner {
    background: #fff8e8;
    border-radius: 10px;
    padding: 3mm 4mm;
    margin-bottom: 3.5mm;
    display: flex;
    align-items: flex-start;
    gap: 3mm;
    border: 2px solid var(--gold);
  }
  .goal-icon { font-size: 17pt; flex-shrink: 0; margin-top: 1mm; }
  .goal-body { flex: 1; min-width: 0; }
  .goal-label { font-size: 7pt; letter-spacing: 0.18em; color: var(--gold); margin-bottom: 1.5mm; }
  .write-line-light {
    width: 100%; background: transparent; border: none;
    border-bottom: 1.5px solid #d4a840; color: var(--ink);
    font-family: 'Noto Sans JP', sans-serif; font-size: 12pt; font-weight: 700;
    padding: 0.5mm 0; outline: none; margin-bottom: 2mm;
  }
  .write-line-light::placeholder { color: #d4c090; font-weight: 400; }
  .memo-row { display: flex; align-items: center; gap: 2mm; margin-bottom: 1.5mm; }
  .memo-row:last-child { margin-bottom: 0; }
  .memo-icon { font-size: 11pt; flex-shrink: 0; }
  .memo-input {
    flex: 1; background: transparent; border: none;
    border-bottom: 1px solid #d4b870; color: var(--ink);
    font-family: 'Noto Sans JP', sans-serif; font-size: 11pt;
    padding: 0.5mm 0; outline: none;
  }
  .memo-input::placeholder { color: #c8b880; }

  /* CHECKBOX */
  label.cb-row { display: flex; align-items: flex-start; gap: 2mm; margin-bottom: 1.5mm; cursor: pointer; }
  label.cb-row:last-child { margin-bottom: 0; }
  .cb-row input[type="checkbox"] {
    appearance: none; -webkit-appearance: none;
    width: 15px; height: 15px;
    border: 2px solid var(--accent-color, #999); border-radius: 3px;
    flex-shrink: 0; margin-top: 2px; cursor: pointer; position: relative; background: transparent;
  }
  .cb-row input[type="checkbox"]:checked { background: var(--accent-color, #999); }
  .cb-row input[type="checkbox"]:checked::after {
    content: ''; position: absolute; left: 2px; top: 0px;
    width: 6px; height: 10px;
    border: 2px solid #fff; border-top: none; border-left: none; transform: rotate(42deg);
  }
  .cb-write {
    flex: 1; background: transparent; border: none;
    border-bottom: 1px solid var(--write-line);
    font-family: 'Noto Sans JP', sans-serif; font-size: 10pt; color: var(--ink);
    padding: 0.5mm 0; outline: none; min-width: 0;
  }
  .cb-write::placeholder { color: #c0b8a8; font-size: 9pt; }
  .cb-row input:checked + .cb-write { color: #aaa; text-decoration: line-through; }

  /* TIMELINE */
  .timeline { position: relative; padding-left: 11mm; }
  .timeline::before {
    content: ''; position: absolute; left: 3mm; top: 6mm; bottom: 6mm; width: 2px;
    background: linear-gradient(to bottom, #f0d080, var(--line) 50%, #a0d4b0);
  }

  /* BLOCK */
  .block { position: relative; margin-bottom: 2mm; }
  .block-dot {
    position: absolute; left: -8.5mm; top: 4.5mm; width: 9px; height: 9px;
    border-radius: 50%; background: var(--accent-color, #999);
    border: 2px solid var(--bg); box-shadow: 0 0 0 1.5px var(--accent-color, #999); z-index: 1;
  }
  .block-card {
    background: var(--card); border-radius: 9px; padding: 2mm 4mm 2mm 4mm;
    border: 1.5px solid var(--line); border-left: 5px solid var(--accent-color, #ccc);
  }
  .block-top { display: flex; align-items: center; gap: 2mm; margin-bottom: 1.5mm; }
  .block-emoji { font-size: 13pt; flex-shrink: 0; }
  .time-input {
    background: transparent; border: none;
    border-bottom: 1.5px solid var(--accent-color, #bbb);
    font-family: 'Noto Sans JP', sans-serif; font-size: 9pt; font-weight: 700;
    letter-spacing: 0.1em; color: var(--accent-color, #888);
    width: 26mm; padding: 0.5mm 0; outline: none; flex-shrink: 0;
  }
  .time-input::placeholder { color: rgba(150,140,120,0.4); font-weight: 400; }
  .title-input {
    flex: 1; background: transparent; border: none;
    border-bottom: 1.5px solid var(--line);
    font-family: 'Noto Sans JP', sans-serif; font-size: 12pt; font-weight: 700;
    color: var(--ink); padding: 0.5mm 0; outline: none; min-width: 0;
  }
  .title-input::placeholder { color: #c8baa0; font-weight: 400; font-size: 10pt; }
  .tasks { display: flex; flex-direction: column; }

  /* FOOTER */
  .footer { text-align: center; margin-top: 3mm; font-size: 9pt; color: #8a7a62; letter-spacing: 0.15em; }

  /* â”€â”€ MODAL â”€â”€ */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.45); z-index: 200;
    align-items: center; justify-content: center; padding: 20px;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--bg); border-radius: 14px; padding: 22px;
    width: 420px; max-width: 100%; max-height: 88vh; overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }
  .modal-title {
    font-family: 'Kaisei Decol', serif; font-size: 18pt; font-weight: 700;
    color: var(--ink); margin-bottom: 14px; padding-bottom: 10px;
    border-bottom: 2px solid var(--gold);
  }
  .save-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
  .save-item {
    display: flex; align-items: center; gap: 8px;
    background: white; border: 1.5px solid var(--line); border-radius: 8px;
    padding: 10px 12px; cursor: pointer; transition: border-color 0.15s;
  }
  .save-item:hover { border-color: var(--gold); }
  .save-item-date { font-size: 11pt; font-weight: 700; color: var(--ink); flex: 1; }
  .save-item-goal { font-size: 9.5pt; color: #8a7a62; flex: 2; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
  .save-item-del {
    background: none; border: none; color: #ccc; font-size: 14pt;
    cursor: pointer; padding: 0 4px; line-height: 1;
  }
  .save-item-del:hover { color: var(--rust, #c45528); }
  .modal-empty { font-size: 10.5pt; color: #aaa; text-align: center; padding: 20px 0; }
  .modal-close-row { text-align: right; }
  .modal-close-btn {
    background: none; border: 1.5px solid var(--line); border-radius: 7px;
    padding: 6px 14px; font-family: 'Noto Sans JP', sans-serif;
    font-size: 10.5pt; cursor: pointer; color: #8a7a62;
  }
  .modal-close-btn:hover { background: var(--line); }

  /* â”€â”€ DRAG HANDLE â”€â”€ */
  .block.dragging { opacity: 0.4; }
  .block.drag-over-top { border-top: 3px solid var(--gold); }
  .drag-handle {
    position: absolute; left: -11mm; top: 50%; transform: translateY(-50%);
    font-size: 11pt; color: #ccc; cursor: grab; user-select: none; padding: 2px 1px; z-index: 2;
  }
  .drag-handle:hover { color: var(--gold); }
  .drag-handle:active { cursor: grabbing; }

  /* â”€â”€ PROGRESS BAR â”€â”€ */
  .progress-wrap {
    width: 210mm; margin: 0 auto 6px;
    background: white; border-radius: 12px; padding: 10px 16px;
    display: flex; align-items: center; gap: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  .progress-label { font-size: 11pt; font-weight: 700; color: var(--ink); white-space: nowrap; }
  .progress-bar-bg { flex: 1; height: 14px; background: #e8e0d0; border-radius: 7px; overflow: hidden; }
  .progress-bar-fill {
    height: 100%; border-radius: 7px;
    background: linear-gradient(to right, #4a7c59, #7ac47a);
    transition: width 0.4s ease;
  }
  .progress-pct { font-size: 14pt; font-weight: 900; color: #4a7c59; width: 48px; text-align: right; }
  .progress-celebrate { font-size: 13pt; }

  /* â”€â”€ REPORT MODAL â”€â”€ */
  .modal-overlay2 {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.45); z-index: 300;
    align-items: center; justify-content: center; padding: 20px;
  }
  .modal-overlay2.open { display: flex; }
  .modal2 {
    background: var(--bg); border-radius: 14px; padding: 22px;
    width: 520px; max-width: 100%; max-height: 90vh; overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }
  .modal2-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 16px; padding-bottom: 10px; border-bottom: 2px solid var(--gold);
  }
  .modal2-title { font-family: 'Kaisei Decol', serif; font-size: 18pt; font-weight: 700; color: var(--ink); }
  .modal2-close { background: none; border: none; font-size: 18pt; cursor: pointer; color: #8a7a62; }
  .modal2-close:hover { color: var(--ink); }
  .cal-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
  .cal-nav-btn { background: none; border: 1.5px solid var(--line); border-radius: 6px; padding: 4px 12px; cursor: pointer; font-size: 13pt; color: var(--ink); }
  .cal-nav-btn:hover { background: var(--line); }
  .cal-month { font-size: 14pt; font-weight: 700; color: var(--ink); }
  .cal-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 3px; margin-bottom: 14px; }
  .cal-dow { text-align: center; font-size: 8pt; color: #8a7a62; padding: 2px 0; font-weight: 700; }
  .cal-day {
    aspect-ratio: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    border-radius: 8px; font-size: 10pt; cursor: default; position: relative; gap: 2px;
  }
  .cal-day.has-data { cursor: pointer; background: #f0f9f3; }
  .cal-day.has-data:hover { background: #d8f0e0; }
  .cal-day.selected { background: #4a7c59 !important; color: white; }
  .cal-day.today { border: 2px solid var(--gold); }
  .cal-day.other-month { color: #ccc; }
  .cal-dot { width: 6px; height: 6px; border-radius: 50%; }
  .detail-panel { background: white; border-radius: 10px; padding: 14px; border: 1.5px solid var(--line); }
  .detail-date { font-size: 12pt; font-weight: 700; color: var(--ink); margin-bottom: 10px; }
  .detail-summary { display: flex; align-items: center; gap: 12px; background: var(--ink); color: #fdf8ee; border-radius: 8px; padding: 10px 14px; margin-bottom: 12px; }
  .detail-big { font-size: 28pt; font-weight: 900; color: #f0d080; line-height: 1; }
  .detail-sub { font-size: 10pt; color: #c8baa0; }
  .detail-goal { font-size: 11pt; font-style: italic; color: #8a7a62; margin-bottom: 10px; }
  .detail-block { margin-bottom: 8px; }
  .detail-block-title { font-size: 10pt; font-weight: 700; color: var(--ink); margin-bottom: 3px; }
  .detail-task { font-size: 9.5pt; color: #666; padding-left: 8px; margin-bottom: 2px; display: flex; gap: 6px; }
  .week-section { margin-top: 14px; }
  .week-title { font-size: 10pt; font-weight: 700; color: #8a7a62; letter-spacing: 0.1em; margin-bottom: 8px; }
  .day-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
  .day-label { font-size: 9.5pt; width: 56px; flex-shrink: 0; color: var(--ink); }
  .day-bar-bg { flex: 1; height: 14px; background: #e8e0d0; border-radius: 7px; overflow: hidden; }
  .day-bar-fill { height: 100%; border-radius: 7px; transition: width 0.4s; }
  .day-pct { font-size: 9.5pt; width: 32px; text-align: right; font-weight: 700; }

  /* PRINT */
  @media print {
    body { background: white; padding: 0; }
    .topbar, .save-status, .progress-wrap { display: none !important; }
    .page { box-shadow: none; margin: 0; }
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    input { border-color: inherit !important; }
    .drag-handle { display: none !important; }
  }
</style>
</head>
<body>

<!-- Progress Bar -->
<div class="progress-wrap" id="progressWrap">
  <span class="progress-label">ä»Šæ—¥ã®é”æˆç‡</span>
  <div class="progress-bar-bg"><div class="progress-bar-fill" id="progressFill" style="width:0%"></div></div>
  <span class="progress-pct" id="progressPct">0%</span>
  <span class="progress-celebrate" id="progressCelebrate"></span>
</div>

<!-- Top Bar -->
<div class="topbar">
  <span class="topbar-date" id="todayLabel"></span>
  <button class="btn btn-gold" onclick="saveToday()">ğŸ’¾ ä»Šæ—¥ã®å†…å®¹ã‚’ä¿å­˜</button>
  <button class="btn btn-green" onclick="openLoadModal()">ğŸ“‚ éå»ã®è¨ˆç”»ã‚’èª­ã¿è¾¼ã‚€</button>
  <button class="btn" style="background:#7055b0" onclick="openReport()">ğŸ“Š é€±é–“ãƒ¬ãƒãƒ¼ãƒˆ</button>
  <button class="btn btn-sky" onclick="exportJSON()">â¬‡ï¸ JSONã§æ›¸ãå‡ºã—</button>
  <label class="btn" style="cursor:pointer">
    â¬†ï¸ JSONã‚’èª­ã¿è¾¼ã‚€
    <input type="file" accept=".json" style="display:none" onchange="importJSON(event)">
  </label>
  <button class="btn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·</button>
</div>
<div class="save-status" id="saveStatus"></div>

<!-- A4 Page -->
<div class="page">

  <div class="header">
    <div class="header-sub">TODAY'S SCHEDULE ï¼ ä»Šæ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
    <div class="header-title">ğŸˆâ€â¬› ä¸€æ—¥ã®è¨ˆç”» ğŸ¾</div>
  </div>

  <div class="goal-banner">
    <div class="goal-icon">ğŸˆâ€â¬›</div>
    <div class="goal-body">
      <div class="goal-label">TODAY'S GOAL ï¼ ä»Šæ—¥ã®ç›®å½“ã¦</div>
      <input class="write-line-light" id="f_goal" type="text" placeholder="ãã‚‡ã†ã®ç›®å½“ã¦ã‚’æ›¸ã“ã†â€¦">
      <div class="memo-row">
        <span class="memo-icon">ğŸ¾</span>
        <input class="memo-input" id="f_memo1" type="text" placeholder="ã‚ã™ã‚Œãªã„ã“ã¨â‘ ">
      </div>
      <div class="memo-row">
        <span class="memo-icon">ğŸ¾</span>
        <input class="memo-input" id="f_memo2" type="text" placeholder="ã‚ã™ã‚Œãªã„ã“ã¨â‘¡">
      </div>
    </div>
  </div>

  <div class="timeline">

    <div class="block" style="--accent-color:#c45528">
      <div class="drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â ¿</div><div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸˆâ€â¬›</span>
          <input class="time-input" id="f_t1" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti1" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb1a"><input class="cb-write" id="f_w1a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb1b"><input class="cb-write" id="f_w1b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#b8892a">
      <div class="drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â ¿</div><div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸ¾</span>
          <input class="time-input" id="f_t2" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti2" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb2a"><input class="cb-write" id="f_w2a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb2b"><input class="cb-write" id="f_w2b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#3278a8">
      <div class="drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â ¿</div><div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸˆâ€â¬›</span>
          <input class="time-input" id="f_t3" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti3" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb3a"><input class="cb-write" id="f_w3a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb3b"><input class="cb-write" id="f_w3b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#7055b0">
      <div class="drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â ¿</div><div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸ¾</span>
          <input class="time-input" id="f_t4" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti4" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb4a"><input class="cb-write" id="f_w4a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb4b"><input class="cb-write" id="f_w4b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#c45528">
      <div class="drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â ¿</div><div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸˆâ€â¬›</span>
          <input class="time-input" id="f_t5" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti5" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb5a"><input class="cb-write" id="f_w5a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb5b"><input class="cb-write" id="f_w5b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#e07b2a">
      <div class="drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â ¿</div><div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸ¾</span>
          <input class="time-input" id="f_t6" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti6" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb6a"><input class="cb-write" id="f_w6a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb6b"><input class="cb-write" id="f_w6b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

    <div class="block" style="--accent-color:#4a7c59">
      <div class="drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â ¿</div><div class="block-dot"></div>
      <div class="block-card">
        <div class="block-top">
          <span class="block-emoji">ğŸˆâ€â¬›</span>
          <input class="time-input" id="f_t7" type="text" placeholder="ã˜ã‹ã‚“ã€œ">
          <input class="title-input" id="f_ti7" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        </div>
        <div class="tasks">
          <label class="cb-row"><input type="checkbox" id="f_cb7a"><input class="cb-write" id="f_w7a" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘ "></label>
          <label class="cb-row"><input type="checkbox" id="f_cb7b"><input class="cb-write" id="f_w7b" type="text" placeholder="ã‚„ã‚‹ã“ã¨â‘¡"></label>
        </div>
      </div>
    </div>

  </div>

  <div class="footer">âœ¦ ä»Šæ—¥ã‚‚ä¸€æ—¥ã‚ˆããŒã‚“ã°ã£ãŸï¼ âœ¦</div>
</div>

<!-- Load Modal -->
<div class="modal-overlay" id="loadModal">
  <div class="modal">
    <div class="modal-title">ğŸ“‚ éå»ã®è¨ˆç”»ã‚’èª­ã¿è¾¼ã‚€</div>
    <div class="save-list" id="saveList"></div>
    <div class="modal-close-row">
      <button class="modal-close-btn" onclick="closeLoadModal()">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<!-- Report Modal -->
<div class="modal-overlay2" id="reportModal">
  <div class="modal2">
    <div class="modal2-header">
      <div class="modal2-title">ğŸ“Š é€±é–“ãƒ¬ãƒãƒ¼ãƒˆ</div>
      <button class="modal2-close" onclick="closeReport()">âœ•</button>
    </div>
    <div class="cal-nav">
      <button class="cal-nav-btn" onclick="calPrev()">â—€</button>
      <div class="cal-month" id="calMonthLabel"></div>
      <button class="cal-nav-btn" onclick="calNext()">â–¶</button>
    </div>
    <div class="cal-grid" id="calGrid"></div>
    <div id="detailPanel"></div>
    <div class="week-section">
      <div class="week-title">ğŸ“… ç›´è¿‘7æ—¥é–“ã®é”æˆç‡</div>
      <div id="weekBars"></div>
    </div>
  </div>
</div>

<script>
  const TEXT_IDS = [
    'f_goal','f_memo1','f_memo2',
    'f_t1','f_ti1','f_w1a','f_w1b',
    'f_t2','f_ti2','f_w2a','f_w2b',
    'f_t3','f_ti3','f_w3a','f_w3b',
    'f_t4','f_ti4','f_w4a','f_w4b',
    'f_t5','f_ti5','f_w5a','f_w5b',
    'f_t6','f_ti6','f_w6a','f_w6b',
    'f_t7','f_ti7','f_w7a','f_w7b',
  ];
  const CB_IDS = [
    'f_cb1a','f_cb1b','f_cb2a','f_cb2b',
    'f_cb3a','f_cb3b','f_cb4a','f_cb4b',
    'f_cb5a','f_cb5b','f_cb6a','f_cb6b',
    'f_cb7a','f_cb7b',
  ];

  function todayStr() {
    const d = new Date();
    return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
  }

  document.getElementById('todayLabel').textContent =
    new Date().toLocaleDateString('ja-JP', {year:'numeric',month:'long',day:'numeric',weekday:'long'});

  // â”€â”€ é”æˆç‡ãƒãƒ¼ â”€â”€
  function updateProgress() {
    const cbs = document.querySelectorAll('.cb-row input[type="checkbox"]');
    const total = cbs.length;
    const done = [...cbs].filter(c => c.checked).length;
    const pct = total === 0 ? 0 : Math.round(done / total * 100);
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('progressPct').textContent = pct + '%';
    document.getElementById('progressCelebrate').textContent =
      pct === 100 ? 'ğŸ‰' : pct >= 80 ? 'âœ¨' : pct >= 50 ? 'ğŸ‘' : '';
    // è‰²
    const fill = document.getElementById('progressFill');
    fill.style.background = pct === 100 ? 'linear-gradient(to right,#f0d080,#e0a030)'
      : pct >= 50 ? 'linear-gradient(to right,#4a7c59,#7ac47a)'
      : 'linear-gradient(to right,#c45528,#e07b2a)';
  }

  // â”€â”€ ãƒ‡ãƒ¼ã‚¿åé›† â”€â”€
  function collectData() {
    const data = { date: todayStr(), texts: {}, checks: {}, blocks: [] };
    TEXT_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) data.texts[id] = el.value;
    });
    CB_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) data.checks[id] = el.checked;
    });
    // è©³ç´°ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆé …ç›®ãƒ©ãƒ™ãƒ«ä¿å­˜ï¼‰
    for (let i = 1; i <= 7; i++) {
      const time = document.getElementById('f_t'+i)?.value || '';
      const title = document.getElementById('f_ti'+i)?.value || '';
      const tasks = ['a','b'].map(s => ({
        label: document.getElementById('f_w'+i+s)?.value || '',
        done: document.getElementById('f_cb'+i+s)?.checked || false,
      })).filter(t => t.label);
      if (title || tasks.length) data.blocks.push({time, title, tasks});
    }
    // é”æˆæ•°
    const cbs = document.querySelectorAll('.cb-row input[type="checkbox"]');
    const filled = [...cbs].filter(c => {
      const idx = CB_IDS.indexOf(c.id);
      if (idx < 0) return false;
      const n = Math.ceil((idx+1)/2);
      const s = idx%2===0?'a':'b';
      return document.getElementById('f_w'+n+s)?.value;
    });
    data.totalItems = filled.length;
    data.doneItems = filled.filter(c => c.checked).length;
    return data;
  }

  function applyData(data) {
    if (data.texts) TEXT_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el && data.texts[id] !== undefined) el.value = data.texts[id];
    });
    if (data.checks) CB_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el && data.checks[id] !== undefined) el.checked = data.checks[id];
    });
    updateProgress();
  }

  // â”€â”€ ä¿å­˜ â”€â”€
  function getSaves() { try { return JSON.parse(localStorage.getItem('schedule_saves') || '[]'); } catch { return []; } }
  function setSaves(arr) { localStorage.setItem('schedule_saves', JSON.stringify(arr)); }

  function saveToday() {
    const data = collectData();
    const saves = getSaves();
    const idx = saves.findIndex(s => s.date === data.date);
    if (idx >= 0) saves[idx] = data; else saves.unshift(data);
    setSaves(saves.slice(0, 60));
    showStatus('âœ… ä¿å­˜ã—ã¾ã—ãŸï¼ˆ' + data.date + 'ï¼‰');
  }

  // ãƒã‚§ãƒƒã‚¯ãƒ»å…¥åŠ›ã§è‡ªå‹•ä¿å­˜ï¼‹é”æˆç‡æ›´æ–°
  document.querySelectorAll('.cb-row input[type="checkbox"]').forEach(el => {
    el.addEventListener('change', () => { updateProgress(); saveToday(); });
  });
  [...TEXT_IDS, ...CB_IDS].forEach(id => {
    const el = document.getElementById(id);
    if (el && el.type !== 'checkbox') el.addEventListener('input', saveToday);
  });

  // â”€â”€ èª­ã¿è¾¼ã¿ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€
  function openLoadModal() { renderSaveList(); document.getElementById('loadModal').classList.add('open'); }
  function closeLoadModal() { document.getElementById('loadModal').classList.remove('open'); }
  document.getElementById('loadModal').addEventListener('click', function(e) { if(e.target===this) closeLoadModal(); });

  function renderSaveList() {
    const saves = getSaves();
    const list = document.getElementById('saveList');
    if (!saves.length) { list.innerHTML = '<div class="modal-empty">ã¾ã ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ğŸ¾</div>'; return; }
    list.innerHTML = saves.map((s,i) => `
      <div class="save-item" onclick="loadSave(${i})">
        <div class="save-item-date">ğŸ“… ${s.date}</div>
        <div class="save-item-goal">${s.texts?.f_goal||'ï¼ˆç›®å½“ã¦ãªã—ï¼‰'}</div>
        <button class="save-item-del" onclick="deleteSave(event,${i})">âœ•</button>
      </div>`).join('');
  }
  function loadSave(i) {
    const s = getSaves()[i];
    if (s) { applyData(s); closeLoadModal(); showStatus('ğŸ“‚ '+s.date+' ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ'); }
  }
  function deleteSave(e,i) {
    e.stopPropagation();
    if (!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    const saves = getSaves(); saves.splice(i,1); setSaves(saves); renderSaveList();
  }

  // â”€â”€ JSONæ›¸ãå‡ºã—ãƒ»èª­ã¿è¾¼ã¿ â”€â”€
  function exportJSON() {
    const blob = new Blob([JSON.stringify(getSaves(),null,2)],{type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='schedule_data_'+todayStr()+'.json'; a.click();
    URL.revokeObjectURL(url);
    showStatus('â¬‡ï¸ JSONã‚’æ›¸ãå‡ºã—ã¾ã—ãŸ');
  }
  function importJSON(event) {
    const file = event.target.files[0]; if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const imported = JSON.parse(e.target.result);
        if (!Array.isArray(imported)) throw new Error();
        const existing = getSaves();
        imported.forEach(item => {
          const idx = existing.findIndex(s=>s.date===item.date);
          if (idx>=0) existing[idx]=item; else existing.push(item);
        });
        existing.sort((a,b)=>b.date.localeCompare(a.date));
        setSaves(existing.slice(0,60));
        showStatus('âœ… '+imported.length+'ä»¶å–ã‚Šè¾¼ã¿ã¾ã—ãŸ');
        event.target.value='';
      } catch { showStatus('âš ï¸ èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
    };
    reader.readAsText(file);
  }

  function showStatus(msg) {
    const el = document.getElementById('saveStatus');
    el.textContent = msg; clearTimeout(el._t);
    el._t = setTimeout(()=>{ el.textContent=''; }, 4000);
  }

  // â”€â”€ é€±é–“ãƒ¬ãƒãƒ¼ãƒˆ â”€â”€
  let calYear, calMonth, selectedDate = null;

  function openReport() {
    const now = new Date();
    calYear = now.getFullYear(); calMonth = now.getMonth();
    selectedDate = null;
    document.getElementById('reportModal').classList.add('open');
    renderCalendar(); renderWeekBars(); renderDetail(null);
  }
  function closeReport() { document.getElementById('reportModal').classList.remove('open'); }
  document.getElementById('reportModal').addEventListener('click', function(e){ if(e.target===this) closeReport(); });

  function calPrev() { calMonth--; if(calMonth<0){calMonth=11;calYear--;} renderCalendar(); }
  function calNext() { calMonth++; if(calMonth>11){calMonth=0;calYear++;} renderCalendar(); }

  function renderCalendar() {
    const saves = getSaves();
    const label = calYear+'å¹´'+(calMonth+1)+'æœˆ';
    document.getElementById('calMonthLabel').textContent = label;
    const grid = document.getElementById('calGrid');
    const dows = ['æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ','æ—¥'];
    let html = dows.map(d=>`<div class="cal-dow">${d}</div>`).join('');
    const first = new Date(calYear, calMonth, 1);
    let startDow = first.getDay(); // 0=æ—¥
    startDow = startDow === 0 ? 6 : startDow - 1; // æœˆæ›œå§‹ã¾ã‚Š
    const daysInMonth = new Date(calYear, calMonth+1, 0).getDate();
    const todayS = todayStr();
    for (let i = 0; i < startDow; i++) html += '<div class="cal-day other-month"></div>';
    for (let d = 1; d <= daysInMonth; d++) {
      const ds = calYear+'-'+String(calMonth+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
      const save = saves.find(s=>s.date===ds);
      const isToday = ds===todayS;
      const isSel = ds===selectedDate;
      let pct = null;
      if (save) {
        if (save.totalItems > 0) pct = Math.round(save.doneItems/save.totalItems*100);
        else { const cbs = Object.values(save.checks||{}); pct = cbs.length?Math.round(cbs.filter(Boolean).length/cbs.length*100):0; }
      }
      const dotColor = pct===null?'':pct>=80?'#4a7c59':pct>=50?'#b8892a':'#c45528';
      html += `<div class="cal-day${save?' has-data':''}${isToday?' today':''}${isSel?' selected':''}"
        ${save?`onclick="selectDate('${ds}')"`:''}>
        <span>${d}</span>
        ${save?`<div class="cal-dot" style="background:${dotColor}"></div>`:''}
      </div>`;
    }
    grid.innerHTML = html;
  }

  function selectDate(ds) {
    selectedDate = ds;
    renderCalendar();
    renderDetail(ds);
  }

  function renderDetail(ds) {
    const panel = document.getElementById('detailPanel');
    if (!ds) { panel.innerHTML = ''; return; }
    const save = getSaves().find(s=>s.date===ds);
    if (!save) { panel.innerHTML = ''; return; }
    let pct, done, total;
    if (save.totalItems > 0) {
      done = save.doneItems; total = save.totalItems;
    } else {
      const cbs = Object.values(save.checks||{});
      done = cbs.filter(Boolean).length; total = cbs.length;
    }
    pct = total ? Math.round(done/total*100) : 0;
    let blocksHtml = '';
    (save.blocks||[]).forEach(b => {
      if (!b.title && !b.tasks?.length) return;
      blocksHtml += `<div class="detail-block">
        <div class="detail-block-title">${b.time?b.time+' ':''}${b.title}</div>
        ${(b.tasks||[]).map(t=>`<div class="detail-task${t.done?' done':''}">
          ${t.done?'â˜‘':'â˜'} <span>${t.label}</span>
        </div>`).join('')}
      </div>`;
    });
    panel.innerHTML = `<div class="detail-panel">
      <div class="detail-date">ğŸ“… ${ds}</div>
      <div class="detail-summary">
        <div><div class="detail-big">${pct}%</div><div class="detail-sub">${done}/${total} é …ç›®é”æˆ</div></div>
      </div>
      ${save.texts?.f_goal?`<div class="detail-goal">ğŸ¯ "${save.texts.f_goal}"</div>`:''}
      ${blocksHtml}
    </div>`;
  }

  function renderWeekBars() {
    const saves = getSaves();
    const dayNames = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
    let html = '';
    for (let i = 6; i >= 0; i--) {
      const d = new Date(); d.setDate(d.getDate()-i);
      const ds = d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');
      const label = (d.getMonth()+1)+'/'+d.getDate()+'ï¼ˆ'+dayNames[d.getDay()]+'ï¼‰';
      const save = saves.find(s=>s.date===ds);
      let pct = null;
      if (save) {
        if (save.totalItems>0) pct=Math.round(save.doneItems/save.totalItems*100);
        else { const cbs=Object.values(save.checks||{}); pct=cbs.length?Math.round(cbs.filter(Boolean).length/cbs.length*100):0; }
      }
      const color = pct===null?'#ccc':pct>=80?'#4a7c59':pct>=50?'#b8892a':'#c45528';
      const isToday = i===0;
      html += `<div class="day-row">
        <div class="day-label" style="${isToday?'font-weight:700;color:var(--gold)':''}">${label}</div>
        <div class="day-bar-bg"><div class="day-bar-fill" style="width:${pct??0}%;background:${color}"></div></div>
        <div class="day-pct" style="color:${color}">${pct!==null?pct+'%':'-'}</div>
      </div>`;
    }
    document.getElementById('weekBars').innerHTML = html;
  }

  // â”€â”€ ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— â”€â”€
  let dragSrc = null;
  function initDrag() {
    document.querySelectorAll('.drag-handle').forEach(handle => {
      handle.addEventListener('mousedown', function(e) {
        const block = handle.closest('.block');
        block.setAttribute('draggable','true');
        block.addEventListener('dragstart', onDragStart);
        block.addEventListener('dragend', onDragEnd);
      });
    });
    const timeline = document.querySelector('.timeline');
    timeline.addEventListener('dragover', onDragOver);
    timeline.addEventListener('drop', onDrop);
  }
  function onDragStart(e) {
    dragSrc = this; this.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
  }
  function onDragEnd(e) {
    this.classList.remove('dragging');
    document.querySelectorAll('.block').forEach(b=>b.classList.remove('drag-over-top'));
    this.setAttribute('draggable','false');
  }
  function onDragOver(e) {
    e.preventDefault(); e.dataTransfer.dropEffect='move';
    const block = e.target.closest('.block');
    document.querySelectorAll('.block').forEach(b=>b.classList.remove('drag-over-top'));
    if (block && block !== dragSrc) block.classList.add('drag-over-top');
  }
  function onDrop(e) {
    e.preventDefault();
    const target = e.target.closest('.block');
    if (!target || target === dragSrc) return;
    const timeline = document.querySelector('.timeline');
    const blocks = [...timeline.querySelectorAll(':scope > .block')];
    const fromIdx = blocks.indexOf(dragSrc);
    const toIdx = blocks.indexOf(target);
    if (fromIdx < toIdx) target.after(dragSrc); else target.before(dragSrc);
    document.querySelectorAll('.block').forEach(b=>b.classList.remove('drag-over-top'));
    saveToday();
  }

  // â”€â”€ èµ·å‹• â”€â”€
  (function() {
    const saves = getSaves();
    const today = saves.find(s=>s.date===todayStr());
    if (today) { applyData(today); showStatus('ğŸ“‚ ä»Šæ—¥ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ'); }
    updateProgress();
    initDrag();
  })();
</script>

</body>
</html>